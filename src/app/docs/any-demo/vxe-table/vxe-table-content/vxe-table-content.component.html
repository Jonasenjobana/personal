<ng-container *ngIf="vxeWraperHeight">
  <!-- 虚拟滚动表格 树形表不支持虚拟滚动 -->
  <cdk-virtual-scroll-viewport
    *ngIf="isVirtual"
    #virtualContent
    class="vxe-virtual-content"
    [style.height.px]="contentHeight"
    [minBufferPx]="virtualConfig.minBuffer || 600"
    [maxBufferPx]="virtualConfig.maxBuffer || 600"
    [itemSize]="virtualConfig.itemHeight || 30"
  >
    <table class="vxe-table" #vxeTable>
      <colgroup>
        <col *ngFor="let item of contentCol" [style.width.px]="item.autoWidth || 50" />
      </colgroup>
      <tbody class="vxe-body">
        <!-- 基础表格 -->
        <ng-template
          *cdkVirtualFor="let item of inData; let index = index"
          [ngTemplateOutlet]="baseTableTemplate"
          [ngTemplateOutletContext]="{item, index}"
        ></ng-template>
      </tbody>
    </table>
  </cdk-virtual-scroll-viewport>
  <ng-container *ngIf="!isVirtual">
    <table #vxeTable class="vxe-table" [style.transform]="'translateX(' + transformX + 'px)'">
      <colgroup>
        <col *ngFor="let item of contentCol" [style.width.px]="item.autoWidth || 50" />
      </colgroup>
      <tbody class="vxe-body">
        <!-- 基础表格 -->
        <ng-container *ngIf="tableModel == 'normal'">
          <ng-template
            *ngFor="let item of inData; let index = index"
            [ngTemplateOutlet]="baseTableTemplate"
            [ngTemplateOutletContext]="{item, index}"
          ></ng-template>
        </ng-container>
        <!-- 树形表格 -->
        <ng-container *ngIf="tableModel == 'tree'">
          <ng-template
            [ngTemplateOutlet]="treeTableTemplate"
            [ngTemplateOutletContext]="{ data: treeData, level: 0 }"
          ></ng-template>
        </ng-container>
      </tbody>
    </table>
  </ng-container>
</ng-container>

<!-- 基础表格 -->
<ng-template #baseTableTemplate let-item="item" let-index="index" let-level="level">
  <tr
    [class.hover]="isHover && index == hoverIndex"
    [class.selected]="item._check"
    (mouseenter)="onMouseEnter(index)"
    (mouseleave)="onMouseLeave()"
  >
    <td *ngFor="let col of contentCol" [style.text-align]="col.align">
      <div
        class="tree-node"
        *ngIf="tableModel == 'tree' && col.treeNode"
        [style.padding-left.px]="item.children.length > 0 ? level * 20 : level * 20 + 14"
      >
        <span
          *ngIf="item.children.length > 0"
          nz-icon
          [nzType]="item._expanded ? 'caret-down' : 'caret-right'"
          nzTheme="outline"
          (click)="expandNode(item, col)"
        ></span>
      </div>
      <ng-container [ngSwitch]="col.type">
        <ng-container *ngSwitchCase="'checkbox'">
          <label nz-checkbox [(ngModel)]="item._check" (ngModelChange)="checkboxChange($event, col, item)"></label>
        </ng-container>
        <ng-container *ngSwitchCase="'seq'"
          ><span *ngIf="tableModel == 'normal'">
            {{ index + 1 }}
          </span>
          <span *ngIf="tableModel == 'tree'">
            {{ item._treeIndex }}
          </span>
        </ng-container>
        <ng-container *ngSwitchDefault>
          <ng-template
            *ngIf="col.template"
            [ngTemplateOutlet]="col.template"
            [ngTemplateOutletContext]="{ row: item, col: col }"
          ></ng-template>
          <span *ngIf="!col.template">{{ item[col.field] }}</span>
        </ng-container>
      </ng-container>
    </td>
  </tr>
</ng-template>
<!-- 树形表格 -->
<ng-template #treeTableTemplate let-data="data" let-level="level">
  <ng-container *ngFor="let item of data; let index = index">
    <ng-container>
      <ng-template
        [ngTemplateOutlet]="baseTableTemplate"
        [ngTemplateOutletContext]="{item, index, level }"
      ></ng-template>
      <!-- 子节点 -->
      <ng-template
        *ngIf="item._expanded"
        [ngTemplateOutlet]="treeTableTemplate"
        [ngTemplateOutletContext]="{ data: item.children, level: level + 1 }"
      ></ng-template>
    </ng-container>
  </ng-container>
</ng-template>
